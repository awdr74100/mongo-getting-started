### 記憶體相關

- 一級記憶體 (Primary Memory、主記憶體、內部記憶體)

  - 通指 RAM 等揮發性設備。
  - 可由 CPU 直接訪問。

- 二級記憶體 (Secondary Memory、輔助記憶體、外部記憶體)

  - 通指 HDD、SSD 等非揮發性設備。
  - 無法由 CPU 直接訪問，OS 必須將從二級記憶體訪問到的數據首先載入到 RAM 中，接著才發送到 CPU 上，RAM 起重要的中間作用，因為其處理速度快於二級記憶體。

- 虛擬記憶體 (Virtual Memory)

  - 為 OS 記憶體管理的一種技術。
  - 可使每個進程認為它擁有連續可用的記憶體 (一個獨立於其他進程且連續的虛擬位址空間)。
  - 虛擬位址空間上任何被分配的虛擬位址 (OS 分配給每個進程的獨立虛擬位址空間中棧、堆、代碼被分配的位址) 將透過 MMU (CPU 上的位址轉換硬體) 映射至實體位址。
  - 不同進程的相同虛擬位址可能 (通常會) 映射至不同實體位址，反之亦然。
  - 映射實際將根據頁表所描述進行，每個虛擬位址空間都有自己的頁表 (即每個程式都有自己的頁表)，其存放了該空間的每個位址映射關係 (PTE)。頁表通常駐留在 RAM 中並由 OS 管理。
  - 頁表基底暫存器內的指標可幫助 MMU 訪問相對應的頁表，OS 在每次進程執行前將負責把正確的指標放進該暫存器中，透過指標即可訪問與進程相對應的頁表。
  - 映射首先將把虛擬位址解析為虛擬頁號和頁偏移量，根據虛擬頁號向頁表查詢對應的實體頁號，將實體頁號結合先前的頁偏移量可得出實體位址，最後對其進行訪問。
  - 頁表存在快取機制、用以減少整個映射過程所花費的時間 (主要能避免向位於 RAM 中的頁表查詢)，透過 TLB (MMU 的內部快取，可視為 CPU 的一種快取) 可將最近映射快取下來並做使用。
  - 在快取機制下，查表將先從 TLB 開始尋找，如果匹配 (稱 TLB 命中) 則繼續訪問實體位置，如果不匹配 (稱 TLB 未命中) 則改向頁表查詢，如果頁表匹配則將其寫回 TLB 並重新執行出錯指令 (後續得出 TLB 命中的結果)，如果頁表不匹配 (相關頁當前未駐留在 RAM 中) 則將引發分頁錯誤，OS 將從二級記憶體檢索相關頁至 RAM 並接連更新頁表及 TLB，在重新執行出錯指令後得出 TLB 命中的結果。

- 分頁 (Paging)

  - 為 OS 記憶體管理的一種技術。
  - 虛擬位址空間和實體位址空間將被劃分成固定大小的塊，虛擬位址空間的塊稱為頁 (Page)，實體位址空間的塊稱為幀 (Frame)，幀的大小與頁相同。
  - 每個虛擬頁都單獨映射到一個實體幀，意即連續的虛擬位址空間可以被映射到非連續的實體位址空間上，該方法可有效避免外部碎片的產生，但可能存在內部碎片。
  - 可使 RAM 在需要時 (釋放、檢索) 與二級記憶體交換數據 (以頁為單位)。
  - 當 RAM 已無可用空間分配給進程時，OS 將透過算法找出最近最少使用到的頁並將其移至二級記憶體 (分頁檔、交換檔、交換空間)，在位址重新映射後原先幀將被釋放，先前進程就可利用此幀以順利完成載入。
  - 當已移至二級記憶體的頁被需要時，OS 會再將其取回至 RAM 上 (可放置於任何的幀上)。
  - 在 RAM 與二級記憶體之間換出 (Swap Out) 及換入 (Swap In) 相當影響性能，因為二級記憶體的處理速度遠慢於 RAM，表示具有足夠的實體 RAM 通常可帶來較好的性能。

- 分頁錯誤 (Page fault、硬體中斷、硬體錯誤)

  - 指當進程試圖訪問已被換出 (Swap Out) 至二級記憶體的頁時 (即訪問當前未駐留在 RAM 中的頁)，由 CPU 中的 MMU 所發出的錯誤異常。
  - 錯誤並不指意義上的錯誤，實際它可被視為一個已知事件 (一種處理機制)，對於任何使用虛擬記憶體的 OS 來說是常見且必要的。
  - 控制權將從進程轉移到 OS，首先將從二級記憶體檢索相關頁至 RAM (放到事先獲取的空 frame 上)，並接連更新頁表及 TLB 以引用新的 frame，完成後將控制權返回給進程，透明地重試出錯的指令。

- 顛簸 (Thrashing、抖動)

  - 指當工作集 (進程在其所需空間中頻繁訪問的頁，即維持基本運作的頁) 的大小超過 RAM 大小時，造成頁將不停地換出及換入 (解決一連串分頁錯誤需釋放很快就得換入的頁) 所嚴重影響性能的問題。
  - 通常會導致 CPU 使用率過高、失控，從而使 OS 陷入停擺。
  - 添加足夠的實體 RAM 或減少工作集大小可明顯的改善此類問題。
